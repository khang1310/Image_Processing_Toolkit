require('dotenv').config()

config = {}
config.imagej_dir = process.env.IMAGEJ_DIR
config.headless = true

console.log('==> Starting ImageJ')
var imagej = require('../index.js')(config)

imagej.on('ready', function(ij) {
    const java = require('java');
    String = java.import("java.lang.String");
    GaussianBlur = java.import('ij.plugin.filter.GaussianBlur');
    ImagePlus = java.import("ij.ImagePlus");
    Opener = java.import("ij.io.Opener");
    ImageProcessor = java.import("ij.process.ImageProcessor");
    BufferedImage = java.import("java.awt.image.BufferedImage");
    ImageIO = java.import("javax.imageio.ImageIO");
    File = java.import("java.io.File");
    g = new GaussianBlur()

    opener = new Opener();
    filePath = "upload_a42697fbe738c6d5af522afe00cd603d";
    imp = opener.openImage(filePath);

    ip = imp.getProcessor();
    ip.setInterpolationMethod(ImageProcessor.BILINEAR);
    console.log(imp.getWidth() + ", " + imp.getHeight());
    ip = ip.resize(imp.getWidth() * 0.5, imp.getHeight() * 0.5);

    newImage = ip.getBufferedImage();
    ImageIO.write(newImage, "jpg", new File("upload_a42697fbe738c6d5af522afe00cd603d"));

    ij.context().dispose()
})